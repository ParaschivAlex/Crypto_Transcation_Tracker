{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Asus/Desktop/FACULTATE/AN 3/React Angular/proiect-fe2/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/Users/Asus/Desktop/FACULTATE/AN 3/React Angular/proiect-fe2/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Users/Asus/Desktop/FACULTATE/AN 3/React Angular/proiect-fe2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Asus/Desktop/FACULTATE/AN 3/React Angular/proiect-fe2/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useReducer,useEffect,useState}from\"react\";import{prjFirestore,timestamp}from'../firebase/configfirebase';var initialState={document:null,isPending:false,error:null,success:null};var firestoreReducer=function firestoreReducer(state,action){switch(action.type){case\"IS_PENDING\":return{success:false,isPending:true,error:null,document:null};case\"ADDED_DOCUMENT\":return{success:true,isPending:false,error:null,document:action.payload};case'DELETED_DOCUMENT':return{isPending:false,document:null,success:true,error:null};case'ERROR':return{isPending:false,document:null,success:false,error:action.payload};default:return state;}};export var useFirestore=function useFirestore(collection){var _useReducer=useReducer(firestoreReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCancelled=_useState2[0],setIsCancelled=_useState2[1];// collection ref\nvar ref=prjFirestore.collection(collection);var dispatchIfNotCancelled=function dispatchIfNotCancelled(action){if(!isCancelled){dispatch(action);}};// add a document\nvar addDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(doc){var createdAt,addedDocument;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:\"IS_PENDING\"});_context.prev=1;createdAt=timestamp.fromDate(new Date());_context.next=5;return ref.add(_objectSpread(_objectSpread({},doc),{},{createdAt:createdAt}));case 5:addedDocument=_context.sent;dispatchIfNotCancelled({type:\"ADDED_DOCUMENT\",payload:addedDocument});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatchIfNotCancelled({type:\"ERROR\",payload:_context.t0.message});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function addDocument(_x){return _ref.apply(this,arguments);};}();// delete a document\nvar deleteDocument=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch({type:'IS_PENDING'});_context2.prev=1;_context2.next=4;return ref.doc(id).delete();case 4:dispatchIfNotCancelled({type:'DELETED_DOCUMENT'});_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](1);dispatchIfNotCancelled({type:'ERROR',payload:'could not delete'});case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[1,7]]);}));return function deleteDocument(_x2){return _ref2.apply(this,arguments);};}();useEffect(function(){return function(){return setIsCancelled(true);};},[]);return{addDocument:addDocument,deleteDocument:deleteDocument,response:response};};","map":{"version":3,"sources":["C:/Users/Asus/Desktop/FACULTATE/AN 3/React Angular/proiect-fe2/src/hooks/useFirestore.tsx"],"names":["useReducer","useEffect","useState","prjFirestore","timestamp","initialState","document","isPending","error","success","firestoreReducer","state","action","type","payload","useFirestore","collection","response","dispatch","isCancelled","setIsCancelled","ref","dispatchIfNotCancelled","addDocument","doc","createdAt","fromDate","Date","add","addedDocument","message","deleteDocument","id","delete"],"mappings":"gkBAAA,OAASA,UAAT,CAAqBC,SAArB,CAAgCC,QAAhC,KAAgD,OAAhD,CACA,OAASC,YAAT,CAAuBC,SAAvB,KAAwC,4BAAxC,CAEA,GAAIC,CAAAA,YAAY,CAAG,CACjBC,QAAQ,CAAE,IADO,CAEjBC,SAAS,CAAE,KAFM,CAGjBC,KAAK,CAAE,IAHU,CAIjBC,OAAO,CAAE,IAJQ,CAAnB,CAOA,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,KAAD,CAAaC,MAAb,CAA6B,CACpD,OAAQA,MAAM,CAACC,IAAf,EACE,IAAK,YAAL,CACE,MAAO,CAACJ,OAAO,CAAE,KAAV,CAAiBF,SAAS,CAAE,IAA5B,CAAkCC,KAAK,CAAE,IAAzC,CAA+CF,QAAQ,CAAE,IAAzD,CAAP,CACF,IAAK,gBAAL,CACE,MAAO,CAACG,OAAO,CAAE,IAAV,CAAgBF,SAAS,CAAE,KAA3B,CAAkCC,KAAK,CAAE,IAAzC,CAA+CF,QAAQ,CAAEM,MAAM,CAACE,OAAhE,CAAP,CACF,IAAK,kBAAL,CACE,MAAO,CAAEP,SAAS,CAAE,KAAb,CAAoBD,QAAQ,CAAE,IAA9B,CAAoCG,OAAO,CAAE,IAA7C,CAAmDD,KAAK,CAAE,IAA1D,CAAP,CACF,IAAK,OAAL,CACE,MAAO,CAAED,SAAS,CAAE,KAAb,CAAoBD,QAAQ,CAAE,IAA9B,CAAoCG,OAAO,CAAE,KAA7C,CAAoDD,KAAK,CAAEI,MAAM,CAACE,OAAlE,CAAP,CACF,QACE,MAAOH,CAAAA,KAAP,CAVJ,CAYD,CAbD,CAeA,MAAO,IAAMI,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,UAAD,CAAqB,CAC/C,gBAA6BhB,UAAU,CAACU,gBAAD,CAAmBL,YAAnB,CAAvC,4CAAOY,QAAP,iBAAiBC,QAAjB,iBACA,cAAsChB,QAAQ,CAAC,KAAD,CAA9C,wCAAOiB,WAAP,eAAoBC,cAApB,eAEA;AACA,GAAMC,CAAAA,GAAG,CAAGlB,YAAY,CAACa,UAAb,CAAwBA,UAAxB,CAAZ,CAEA,GAAMM,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACV,MAAD,CAAiB,CAC9C,GAAI,CAACO,WAAL,CAAkB,CAChBD,QAAQ,CAACN,MAAD,CAAR,CACD,CACF,CAJD,CAMA;AACA,GAAMW,CAAAA,WAAW,0FAAG,iBAAOC,GAAP,8IAClBN,QAAQ,CAAC,CAAEL,IAAI,CAAE,YAAR,CAAD,CAAR,CADkB,gBAIVY,SAJU,CAIErB,SAAS,CAACsB,QAAV,CAAmB,GAAIC,CAAAA,IAAJ,EAAnB,CAJF,uBAKYN,CAAAA,GAAG,CAACO,GAAJ,gCAAYJ,GAAZ,MAAiBC,SAAS,CAATA,SAAjB,GALZ,QAKVI,aALU,eAMhBP,sBAAsB,CAAC,CAAET,IAAI,CAAE,gBAAR,CAA0BC,OAAO,CAAEe,aAAnC,CAAD,CAAtB,CANgB,+EAShBP,sBAAsB,CAAC,CAAET,IAAI,CAAE,OAAR,CAAiBC,OAAO,CAAE,YAAIgB,OAA9B,CAAD,CAAtB,CATgB,oEAAH,kBAAXP,CAAAA,WAAW,4CAAjB,CAcA;AACA,GAAMQ,CAAAA,cAAc,2FAAG,kBAAOC,EAAP,sHACrBd,QAAQ,CAAC,CAAEL,IAAI,CAAE,YAAR,CAAD,CAAR,CADqB,wCAIbQ,CAAAA,GAAG,CAACG,GAAJ,CAAQQ,EAAR,EAAYC,MAAZ,EAJa,QAKnBX,sBAAsB,CAAC,CAAET,IAAI,CAAE,kBAAR,CAAD,CAAtB,CALmB,mFAQnBS,sBAAsB,CAAC,CAAET,IAAI,CAAE,OAAR,CAAiBC,OAAO,CAAE,kBAA1B,CAAD,CAAtB,CARmB,sEAAH,kBAAdiB,CAAAA,cAAc,8CAApB,CAYA9B,SAAS,CAAC,UAAM,CACd,MAAO,kBAAMmB,CAAAA,cAAc,CAAC,IAAD,CAApB,EAAP,CACD,CAFQ,CAEN,EAFM,CAAT,CAIA,MAAO,CAAEG,WAAW,CAAXA,WAAF,CAAeQ,cAAc,CAAdA,cAAf,CAA+Bd,QAAQ,CAARA,QAA/B,CAAP,CAED,CA/CM","sourcesContent":["import { useReducer, useEffect, useState } from \"react\"\r\nimport { prjFirestore, timestamp } from '../firebase/configfirebase' \r\n\r\nlet initialState = {\r\n  document: null as null,\r\n  isPending: false,\r\n  error: null as null,\r\n  success: null as null,\r\n}\r\n\r\nconst firestoreReducer = (state: any, action: any) => {\r\n  switch (action.type) {\r\n    case \"IS_PENDING\":\r\n      return {success: false, isPending: true, error: null, document: null}\r\n    case \"ADDED_DOCUMENT\":\r\n      return {success: true, isPending: false, error: null, document: action.payload}\r\n    case 'DELETED_DOCUMENT':\r\n      return { isPending: false, document: null, success: true, error: null }\r\n    case 'ERROR':\r\n      return { isPending: false, document: null, success: false, error: action.payload }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport const useFirestore = (collection: any) => {\r\n  const [response, dispatch] = useReducer(firestoreReducer, initialState)\r\n  const [isCancelled, setIsCancelled] = useState(false)\r\n\r\n  // collection ref\r\n  const ref = prjFirestore.collection(collection)\r\n  \r\n  const dispatchIfNotCancelled = (action: any) => {\r\n    if (!isCancelled) {\r\n      dispatch(action)\r\n    }\r\n  }\r\n\r\n  // add a document\r\n  const addDocument = async (doc: any) => {\r\n    dispatch({ type: \"IS_PENDING\" })\r\n\r\n    try {\r\n      const createdAt = timestamp.fromDate(new Date())\r\n      const addedDocument = await ref.add({...doc, createdAt})\r\n      dispatchIfNotCancelled({ type: \"ADDED_DOCUMENT\", payload: addedDocument })\r\n    }\r\n    catch (err) {\r\n      dispatchIfNotCancelled({ type: \"ERROR\", payload: err.message })\r\n    }\r\n\r\n  }\r\n\r\n  // delete a document\r\n  const deleteDocument = async (id: any) => {\r\n    dispatch({ type: 'IS_PENDING' })\r\n\r\n    try {\r\n      await ref.doc(id).delete()\r\n      dispatchIfNotCancelled({ type: 'DELETED_DOCUMENT' })\r\n    }\r\n    catch (err) {\r\n      dispatchIfNotCancelled({ type: 'ERROR', payload: 'could not delete' })\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    return () => setIsCancelled(true)\r\n  }, [])\r\n\r\n  return { addDocument, deleteDocument, response }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}